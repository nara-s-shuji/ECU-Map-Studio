<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <title>ECU Map Studio 2026</title>
    <!-- Offline Plotly Library -->
    <script src="lib/plotly.min.js"></script>
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/style.css?v=3.1">
    <script>
        window.onerror = function (msg, url, line, col, error) {
            // Note: In a real app we might not alert, but here we need user feedback
            // alert("JS Error: " + msg + "\nLine: " + line); 
            console.error("JS Error:", msg, line, error);
            return false;
        };
    </script>
</head>

<body>

    <div id="toolbar">
        <button class="toolbar-btn" data-tooltip="ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã (Ctrl+O)" onclick="openFile()">ğŸ“</button>
        <button class="toolbar-btn" data-tooltip="åŸºæº–ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã (Ctrl+Shift+O)" onclick="openBaseFile()">ğŸ“‹</button>
        <button class="toolbar-btn" data-tooltip="ä¿å­˜ (Ctrl+S)" onclick="saveFile()">ğŸ’¾</button>

        <div class="toolbar-separator"></div>

        <button class="toolbar-btn" data-tooltip="å…ƒã«æˆ»ã™ (Ctrl+Z)" onclick="undo()" id="btn-undo">â†¶</button>
        <button class="toolbar-btn" data-tooltip="ã‚„ã‚Šç›´ã— (Ctrl+Y)" onclick="redo()" id="btn-redo">â†·</button>

        <div class="toolbar-separator"></div>

        <button class="toolbar-btn ecu-disconnected" data-tooltip="ECUã«æ¥ç¶š" onclick="toggleECUConnection()"
            id="btn-ecu-connect">
            <!-- WiFi + ECU Icon -->
            <svg viewBox="0 0 24 24" class="icon-svg">
                <!-- WiFi Arcs -->
                <path
                    d="M12 3c4.284 0 8.232 1.452 11.416 3.96l-1.632 2.04C19.124 7.02 15.732 5.76 12 5.76c-3.744 0-7.14 1.26-9.784 3.24L0.584 6.96C3.768 4.452 7.716 3 12 3z"
                    fill="currentColor" />
                <path
                    d="M12 7.8c3.084 0 5.928 1.044 8.22 2.844l-1.632 2.04C16.92 11.4 14.568 10.56 12 10.56c-2.58 0-4.932 0.84-6.588 2.124l-1.632-2.04C6.072 8.844 8.916 7.8 12 7.8z"
                    fill="currentColor" />
                <!-- ECU Box below -->
                <path d="M6 14h12v7c0 1.1-0.9 2-2 2H8c-1.1 0-2-0.9-2-2v-7z" fill="currentColor" />
                <rect x="7" y="16" width="3" height="4" fill="var(--bg)" />
                <rect x="11" y="16" width="1" height="4" fill="var(--bg)" />
                <rect x="13" y="16" width="1" height="4" fill="var(--bg)" />
                <rect x="15" y="16" width="2" height="1" fill="var(--bg)" />
                <rect x="15" y="18" width="2" height="1" fill="var(--bg)" />
            </svg>
        </button>
        <button class="toolbar-btn" data-tooltip="ECUã«æ›¸ãè¾¼ã¿ (Ctrl+W)" onclick="writeToECU()" id="btn-write"
            disabled>ğŸ“¤</button>
        <button class="toolbar-btn" data-tooltip="ECUã‹ã‚‰èª­ã¿å–ã‚Š (Ctrl+R)" onclick="readFromECU()" id="btn-read"
            disabled>ğŸ“¥</button>

        <div class="toolbar-separator"></div>

        <button class="toolbar-btn" data-tooltip="ã‚°ãƒ©ãƒ•è¡¨ç¤º (Ctrl+G)" onclick="toggleGraph()" id="btn-graph">ğŸ“Š</button>

        <span class="toolbar-title">ECU Map Studio - Kitaco S3 v1.0</span>
        <button class="hamburger-menu" onclick="toggleSettings()" id="btn-settings">â˜°</button>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ: ã‚µã‚¤ãƒ‰ãƒãƒ¼ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„éƒ¨åˆ† -->
    <div id="main-container">
        <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
        <div id="explorer">
            <div class="explorer-header">EXPLORER: PROJECT</div>
            <div class="tree-item"><span class="tree-icon">ğŸ“</span> src</div>
            <div class="tree-item active"><span class="tree-icon">ğŸ“Š</span> Main_Fuel_Map.csv</div>
            <div class="tree-item"><span class="tree-icon">ğŸ“Š</span> Ignition_Map.csv</div>
            <div class="tree-item"><span class="tree-icon">ğŸ“Š</span> Idling_Correction.csv</div>
            <div class="tree-item"><span class="tree-icon">âš™ï¸</span> Settings.json</div>

            <div class="explorer-header" style="margin-top:20px;">ACTIONS</div>
            <div style="padding: 0 10px;">
                <p style="font-size: 10px; color: #666; margin: 10px 0;">ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¯ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã‹ã‚‰å®Ÿè¡Œã—ã¦ãã ã•ã„</p>
            </div>
        </div>

        <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
        <div id="content-area">

            <!-- 1. ã‚¨ãƒ‡ã‚£ã‚¿ãƒ“ãƒ¥ãƒ¼ -->
            <div id="editor-view" class="view-section active">
                <div id="info-section">
                    <div class="info-item">
                        <span class="info-label">Selected:</span>
                        <span class="info-value" id="info-cell">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Value:</span>
                        <span class="info-value" id="info-value">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label" style="color: #0078d4;">Original:</span>
                        <span class="info-value" id="info-original">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Change:</span>
                        <span class="info-value" id="info-change">-</span>
                        <span class="info-value" id="info-change-percent" style="font-size: 0.8em; color: #888;"></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Range:</span>
                        <span class="info-value" id="info-range">-</span>
                    </div>
                </div>

                <div id="map-section">
                    <div id="table-wrapper">
                        <div id="headerRow" class="header-row"></div>
                        <!-- æ­£ã—ã„ã‚¯ãƒ©ã‚¹å: grid-container -->
                        <div id="mapGrid" class="grid-container"></div>
                    </div>
                </div>
            </div>

            <!-- 2. ãƒ¢ãƒ‹ã‚¿ãƒ¼ãƒ“ãƒ¥ãƒ¼ -->
            <div id="monitor-view" class="view-section"
                style="display:none; padding: 20px; text-align: center; color: #888; justify-content: center; align-items: center;">
                <h2>ğŸ“Š Monitor Mode</h2>
                <p>æœªå®Ÿè£… (Coming Soon)</p>
            </div>

            <!-- 3. ãƒ­ã‚¬ãƒ¼ãƒ“ãƒ¥ãƒ¼ -->
            <div id="logger-view" class="view-section"
                style="display:none; padding: 20px; text-align: center; color: #888; justify-content: center; align-items: center;">
                <h2>ğŸ’¾ Data Logger</h2>
                <p>æœªå®Ÿè£… (Coming Soon)</p>
            </div>

        </div>
    </div>

    <!-- Bottom Navigation -->
    <div id="bottom-nav" style="touch-action: none;">
        <button class="nav-item active" onclick="switchTab('editor')">
            <span class="nav-icon">â–¤</span>
            <span>ç·¨é›†</span>
        </button>
        <button class="nav-item" onclick="switchTab('graph')">
            <span class="nav-icon">ğŸ“‰</span>
            <span>ã‚°ãƒ©ãƒ•</span>
        </button>
        <button class="nav-item" onclick="switchTab('monitor')">
            <span class="nav-icon">ğŸ“Š</span>
            <span>ãƒ¢ãƒ‹ã‚¿ãƒ¼</span>
        </button>
        <button class="nav-item" onclick="switchTab('logger')">
            <span class="nav-icon">ğŸ“ˆ</span>
            <span>ãƒ­ã‚°</span>
        </button>
        <button class="nav-item" onclick="toggleSettings()">
            <!-- Hamburger Icon -->
            <span class="nav-icon">â‰¡</span>
            <span>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</span>
        </button>
    </div>

    <!-- Scripts -->
    <script src="js/app.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/map.js"></script>
    <script src="js/graph.js"></script>

</body>

</html>